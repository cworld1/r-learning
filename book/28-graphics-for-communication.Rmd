# Graphics for communication {#graphics-for-communication}

åœ¨ä¹‹å‰çš„æ•°æ®åˆ†æä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ä½¿ç”¨ç»˜å›¾ä½œä¸ºä¸€ç§å¼ºæœ‰åŠ›çš„ç†è§£æ•°æ®çš„å·¥å…·ã€‚å½“æˆ‘ä»¬è¿›è¡Œç»˜å›¾å¯è§†åŒ–åˆ†ææ—¶ï¼Œä¼šä¸ºæ¯ä¸ªç»†èŠ‚åšäº†ä¸€ä¸ªé’ˆå¯¹æ€§çš„åˆ†æï¼Œæ–¹ä¾¿æˆ‘ä»¬å¿«é€ŸæŸ¥çœ‹å’Œåˆ†æå®ƒä»¬ï¼Œç„¶ååˆ†æä¸‹ä¸€ä¸ªç»†èŠ‚ã€‚åœ¨å¤§å¤šæ•°åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸ä¸€ä¼šå°±ä¼šäº§ç”Ÿæ•°åæˆ–æ•°ç™¾å¼  ggplot å›¾ï¼Œè€Œä¸”å…¶ä¸­å¤§éƒ¨åˆ†ä¼šç«‹å³è¢«æ‰”æ‰ã€‚

å½“æˆ‘ä»¬å·²ç»æ·±åˆ»è®¤è¯†ç†Ÿæ‚‰äº†æ•°æ®ï¼ˆå¦‚ flightsï¼‰åï¼Œæ›´å¤šè¦åšçš„æ˜¯å°†è‡ªå·±çš„ç†è§£ä¼ è¾¾ç»™å…¶ä»–äººã€‚ç„¶è€Œå“ªäº›å—ä¼—äººç¾¤å¯èƒ½ä¸é‚£ä¹ˆé‡è§†å…¶èƒŒæ™¯çŸ¥è¯†ï¼Œä¹Ÿä¸ä¼šæ·±å…¥ç ”ç©¶æ•°æ®ã€‚ä¸ºäº†å¸®åŠ©å…¶ä»–äººå¿«é€Ÿå»ºç«‹è‰¯å¥½çš„æ•°æ®å¿ƒç†æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥å­¦ä¹  ggplot2 ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€äº›ç‰¹æ®Šå·¥å…·ï¼Œå› ä¸ºåœ¨å¯å±•ç¤ºæ€§å’Œä¼˜åŒ–æ€§ä¸Šï¼Œå®ƒå¸¦æ¥çš„å®é™…æ€§è¿›å±•ï¼Œå®åœ¨æ˜¯å¤ªå¤šäº†ã€‚

```{R setup, results = "hide", message = FALSE, warning = FALSE}
library(tidyverse)
```

## å›¾å¤–æ ‡ç­¾

è¯•å›¾å°†æ¢ç´¢æ€§å›¾å½¢è½¬æ¢ä¸ºè¯´æ˜æ€§å›¾å½¢æ—¶ï¼Œæœ€ç®€å•çš„èµ·ç‚¹æ˜¯èµ·ä¸ªä¸€çœ¼ä¸çœŸçš„æ ‡é¢˜ã€‚`labs` çš„ `title` é…ç½®é¡¹å°±æ˜¯åšè¿™ä¸ªçš„ï¼š

```{R labs() with title}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(title = "Fuel efficiency generally decreases with engine size")
```

æ ‡é¢˜çš„ç›®çš„ä¸€èˆ¬æ˜¯æ€»ç»“æœ€ä¸»è¦çš„å‘ç°ã€‚é¿å…ä½¿ç”¨ä»…æè¿°æƒ…èŠ‚çš„æ ‡é¢˜ï¼Œå¦‚ â€œå‘åŠ¨æœºæ’é‡ä¸ç‡ƒæ²¹ç»æµæ€§çš„æ•£ç‚¹å›¾â€ã€‚

æ­¤å¤–è¿˜æœ‰ä¸€äº›å°æ ‡é¢˜ä½ å¯èƒ½ç”¨å¾—ä¸Šï¼š

- `subtitle`ï¼šå‰¯æ ‡é¢˜ï¼Œåœ¨æ ‡é¢˜ä¸‹æ–¹ä»¥å°å·å­—ä½“æ·»åŠ å…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚
- `caption`ï¼šåœ¨ç»˜å›¾çš„å³ä¸‹è§’æ·»åŠ æ–‡æœ¬ï¼Œé€šå¸¸ç”¨äºæè¿°æ•°æ®æºã€‚

```{R labs() with subtitle & caption}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov"
  )
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ›¿æ¢è½´å’Œå›¾ä¾‹æ ‡é¢˜ã€‚ä¸è¿‡æœ€å¥½å°†ç®€çŸ­çš„å˜é‡åç§°æ›¿æ¢ä¸ºæ›´è¯¦ç»†çš„æè¿°ï¼Œå¹¶åŒ…å«å•ä½ï¼š

```{R labs() with x & y & colour}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

å¯¹äºæˆ‘ä»¬åœ¨å»ºæ¨¡æ—¶å¸¸å¸¸ä½¿ç”¨åˆ°çš„æ±‚å¯¹æ•°ç­‰è¡¨è¾¾å¼ï¼Œå…¶å®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨æ•°å­¦æ–¹ç¨‹å¼ä»£æ›¿æ–‡æœ¬å­—ç¬¦ä¸²çš„ã€‚åªéœ€ç”¨ä¸Š [quote()](https://rdrr.io/r/base/substitute.html) å³å¯å®Œæˆè½¬æ¢ï¼ˆæœ‰ç‚¹åƒåœ¨ markdown é‡Œæ’å…¥ Latex å…¬å¼å†…å‘³ï¼Œä½†åœ¨ä¹¦å†™ä¸Šè¦ç®€å•ä¸€äº›ï¼‰ï¼š

```{R labs() with quote()}
df <- tibble(
  x = runif(10),
  y = runif(10)
)
ggplot(df, aes(x, y)) +
  geom_point() +
  labs(
    x = quote(sum(x[i] ^ 2, i == 1, n)),
    y = quote(alpha + beta + frac(delta, theta))
  )
```

## å›¾å†…æ ‡æ³¨

é™¤äº†æ ‡è®°å›¾çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ä¹‹å¤–ï¼Œæ ‡è®°å•ä¸ªè§‚æµ‹å€¼æˆ–è§‚æµ‹å€¼ç»„é€šå¸¸ä¹Ÿå¾ˆæœ‰ç”¨ã€‚

```{R geom_text()}
best_in_class <- mpg %>%
  group_by(class) %>%
  filter(row_number(desc(hwy)) == 1) # ç­›é€‰å‡ºè¡Œåä¸º 1 çš„ï¼Œå³æ¯ç§ç±»å‹çš„ç¬¬ä¸€ä¸ªæ•°æ®

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_text(aes(label = model), data = best_in_class)
```

äº‹æƒ…å¥½åƒå¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•... æ ‡ç­¾å½¼æ­¤é‡å ï¼Œå¹¶ä¸”ä¸ç‚¹ä¹Ÿé‡å åœ¨ä¸€èµ·ã€‚è¿™å¾ˆéš¾é˜…è¯»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ‡æ¢åˆ°å“ªä¸ªåœ¨æ–‡æœ¬åé¢ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢ï¼Œå¹¶å°†æ ‡ç­¾ç§»åŠ¨åˆ°ç›¸åº”ç‚¹çš„ä¸Šæ–¹æ¥è§£å†³é—®é¢˜ï¼š

```{R geom_label()}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_label(aes(label = model), data = best_in_class, nudge_y = 2, alpha = 0.5) # geom_label() èƒ½é¿å…ä¹‹é—´é‡å ï¼Œnudge_y æˆ– nudge_x ç”¨äºè®¾ç½®åç§»é‡ï¼Œéµå¾ªå¹³é¢åæ ‡ç³»æ³•åˆ™ã€‚æ­¤å¤–å‡å°‘ä¸é€æ˜åº¦ä¹Ÿæ˜¯ä¸äºŒä½³é€‰
```

è¿™æœ‰ç‚¹å¸®åŠ©ï¼Œä½†ä»”ç»†è§‚å¯Ÿï¼Œå…¶å®æ ‡ç­¾ä¹‹é—´è¿˜æ˜¯ä¼šæœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹é‡å å½±å“ã€‚ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºç´§å‡‘å‹å’Œæ¬¡ç´§å‡‘å‹ç±»åˆ«ä¸­æœ€ä½³æ±½è½¦çš„é«˜é€Ÿå…¬è·¯é‡Œç¨‹å’Œæ’é‡å®Œå…¨ç›¸åŒã€‚å½“ä½ æ— æ³•é€šè¿‡å¯¹æ¯ä¸ªæ ‡ç­¾åº”ç”¨ç›¸åŒçš„è½¬æ¢æ¥è§£å†³è¿™äº›é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ `ggrepel::geom_label_repel()`ã€‚å®ƒå°†è‡ªåŠ¨è°ƒæ•´æ ‡ç­¾ï¼Œä½¿å®ƒä»¬ä¸ä¼šé‡å ï¼š

```{R geom_label_repel}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_point(size = 3, shape = 1, data = best_in_class) +
  ggrepel::geom_label_repel(aes(label = model), data = best_in_class)
```

~~äººå·¥æ™ºéšœæ ‡ç­¾çœŸå¥½ç”¨~~ã€‚æ³¨æ„è¿™é‡Œæ·»åŠ äº†å¤–åœˆå¤§å·çš„ç©ºå¿ƒç‚¹ï¼Œä»¥çªå‡ºæ˜¾ç¤ºæ‰€æ ‡è®°çš„ç‚¹ã€‚

æ­¤å¤–ä¹Ÿå¯ä»¥ç›´æ¥æŠŠå›¾ä¾‹æŒªåˆ°å›¾ä¸Šå»åšæ ‡æ³¨ã€‚è¿™ç§æ–¹æ³•å¥½åƒå¹¶ä¸ä¼˜é›…ï¼Œä½†ç¡®å®èƒ½è§£å†³é—®é¢˜è€Œä¸”ä¹Ÿä¸ç®—å¾ˆéš¾ç”¨ï¼š

```{R geom_label_repel() with theme() with legend.position}
class_avg <- mpg %>%
  group_by(class) %>%
  summarise(
    displ = median(displ),
    hwy = median(hwy)
  )

ggplot(mpg, aes(displ, hwy, colour = class)) +
  ggrepel::geom_label_repel(aes(label = class),
    data = class_avg,
    label.size = 0, # æŒ‡æ˜æ ‡ç­¾ä¸å ä½
    segment.color = NA
  ) +
  geom_point() +
  theme(legend.position = "none") # éšè—æ—è¾¹çš„å›¾ä¾‹
```

æ­¤å¤–æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨å›¾å†…åŠ ä¸€äº›ä¿¡æ¯è¯´æ˜ï¼š

```{R geom_text() with label}
label <- mpg %>%
    summarise(
        displ = max(displ),
        hwy = max(hwy),
        label = "Increasing engine size is \nrelated to decreasing fuel economy." # æ³¨æ„ label åœ¨è¿™é‡Œä¹¦å†™ä¼šè‡ªåŠ¨æ·»åŠ æ–°åˆ—
    )

# å½“ç„¶å•çº¯å†™ä¸ª label ä¹Ÿå¯ä»¥ä¸è¦é‚£äº›æ•°æ®
label <- tibble(
  displ = Inf,
  hwy = Inf,
  label = "Increasing engine size is \nrelated to decreasing fuel economy."
)

ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_text(aes(label = label), data = label, vjust = "top", hjust = "right") # vjust å’Œ hjust ç”¨äºè¯´æ˜åœ¨ç«–ç›´æ–¹å‘å’Œæ°´å¹³æ–¹å‘çš„ç›¸å¯¹ä½ç½®
```

é™¤äº†æ‰‹åŠ¨ç”¨æ¢è¡Œç¬¦å°†å†…å®¹åˆ†è§£ä¸ºå¤šè¡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œç»™å®šæ¯è¡Œæ‰€éœ€çš„å­—ç¬¦æ•°å³å¯ï¼š

```{R str_wrap()}
"Increasing engine size is related to decreasing fuel economy." %>%
  stringr::str_wrap(width = 40) %>% # ä»¥è¡Œå®½åˆ†å‰²å¹¶æ·»åŠ æ¢è¡Œç¬¦
  writeLines()
```

å¯¹äºåˆšåˆšçš„ `hjust` å’Œ `vjust` å‚æ•°ï¼Œæˆ‘ä»¬è¿™é‡Œç»™å‡ºä¸€ä¸ªå›¾ğŸ‘‡ï¼ˆå¥½è€¶ï¼‰ï¼š

![â€œhjustâ€ å’Œ â€œvjustâ€ çš„æ‰€æœ‰ä¹ç§ç»„åˆ](https://d33wubrfki0l68.cloudfront.net/9f9f1806b5c583874a725bdff526e990bd4fcba6/b955a/communicate-plots_files/figure-html/just-1.png)

## æ¯”ä¾‹å°ºä¸å‚è€ƒ

### æ¯”ä¾‹å°º

äº‹å®ä¸Šåœ¨ä½ ç»˜åˆ¶å›¾æ—¶ï¼Œggplot ä¼šè‡ªåŠ¨ä¸ºä½ å‡†å¤‡å¥½äº†æ¯”ä¾‹å°ºã€‚å¦‚ï¼š

```R
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))

# ggplot ä¼šè‡ªåŠ¨å¸®ä½ è¡¥å…¨æˆè¿™æ ·ï¼š
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  scale_x_continuous() +
  scale_y_continuous() +
  scale_colour_discrete()
```

ä¸è¿‡ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„æ‹‰ã€‚

```{R scale_y_continuous() with breaks}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_y_continuous(breaks = seq(15, 40, by = 5))
```

å»æ‰ä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼š

```{R scale_y_continuous() with labels}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = NULL)
```

`labels` çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯å½“æˆ‘ä»¬çš„æ•°æ®ç‚¹ç›¸å¯¹è¾ƒå°‘å¹¶ä¸”æƒ³è¦çªå‡ºæ˜¾ç¤ºè§‚æµ‹å€¼å‘ç”Ÿçš„ç¡®åˆ‡ä½ç½®æ—¶ã€‚å¦‚ä¸‹å›¾å°±æ¸…æ™°åœ°å®ƒæ˜¾ç¤ºäº†æ¯ä½ç¾å›½æ€»ç»Ÿä½•æ—¶å¼€å§‹å’Œç»“æŸå…¶ä»»æœŸï¼š

```{R scale_x_date()}
presidential %>%
  mutate(id = 33 + row_number()) %>%
  ggplot(aes(start, id)) +
    geom_point() +
    # ç‚¹å±•å›¾ï¼Œä»¥ç‚¹ä¸ºä¸­å¿ƒå‘ x æ–¹å‘å»¶ä¼¸çº¿æ¡ï¼Œy æ–¹å‘é”™å¼€æ•°æ®
    geom_segment(aes(xend = end, yend = id)) +
    scale_x_date(NULL, breaks = presidential$start, date_labels = "'%y")
```

### å›¾ä¾‹

å›¾ä¾‹ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œæ¯”å¦‚å®ƒçš„ä½ç½®ï¼š

```{R theme() with legend.position}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))

base + theme(legend.position = "left")
base + theme(legend.position = "top")
base + theme(legend.position = "bottom")
base + theme(legend.position = "right") # é»˜è®¤
```

